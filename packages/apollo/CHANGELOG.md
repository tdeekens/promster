# @promster/apollo

## 15.3.1

### Patch Changes

- [#1376](https://github.com/tdeekens/promster/pull/1376) [`a3b96f5`](https://github.com/tdeekens/promster/commit/a3b96f5c724530e9e48d778527cc5b1a8efdfede) Thanks [@tdeekens](https://github.com/tdeekens)! - Fixes types and type checking on CI

- Updated dependencies [[`a3b96f5`](https://github.com/tdeekens/promster/commit/a3b96f5c724530e9e48d778527cc5b1a8efdfede)]:
  - @promster/metrics@15.3.1
  - @promster/types@15.3.1

## 15.3.0

### Patch Changes

- Updated dependencies []:
  - @promster/metrics@15.3.0
  - @promster/types@15.3.0

## 15.2.0

### Patch Changes

- Updated dependencies []:
  - @promster/metrics@15.2.0
  - @promster/types@15.2.0

## 15.1.0

### Patch Changes

- Updated dependencies []:
  - @promster/metrics@15.1.0
  - @promster/types@15.1.0

## 15.0.1

### Patch Changes

- Updated dependencies []:
  - @promster/metrics@15.0.1
  - @promster/types@15.0.1

## 15.0.0

### Patch Changes

- [#1304](https://github.com/tdeekens/promster/pull/1304) [`4ad33f6`](https://github.com/tdeekens/promster/commit/4ad33f69715de457299af7457d30ed80b752548b) Thanks [@tdeekens](https://github.com/tdeekens)! - Refactor to use biome over ESLint and prettier

- [#1321](https://github.com/tdeekens/promster/pull/1321) [`288172a`](https://github.com/tdeekens/promster/commit/288172a52d44bac7afd7df19495ee02063be66a8) Thanks [@renovate](https://github.com/apps/renovate)! - chore(deps): update dependency graphql to v16.10.0

- [#1217](https://github.com/tdeekens/promster/pull/1217) [`9d3f8b1`](https://github.com/tdeekens/promster/commit/9d3f8b14ba5b2aa4e6094d1cdf09ea049895f44d) Thanks [@tdeekens](https://github.com/tdeekens)! - Update all dependencies

- [#1352](https://github.com/tdeekens/promster/pull/1352) [`3e09699`](https://github.com/tdeekens/promster/commit/3e096994cf3c1f77c6f0adec549e0a36d6e15ed8) Thanks [@tdeekens](https://github.com/tdeekens)! - Update dependencies and update documentatation

- Updated dependencies [[`9d3f8b1`](https://github.com/tdeekens/promster/commit/9d3f8b14ba5b2aa4e6094d1cdf09ea049895f44d), [`3e09699`](https://github.com/tdeekens/promster/commit/3e096994cf3c1f77c6f0adec549e0a36d6e15ed8)]:
  - @promster/metrics@15.0.0
  - @promster/types@15.0.0

## 14.0.0

### Patch Changes

- Updated dependencies [[`7668337`](https://github.com/tdeekens/promster/commit/766833787529d8a1ee603211240d31be6eaa939e)]:
  - @promster/metrics@14.0.0
  - @promster/types@14.0.0

## 13.0.0

### Major Changes

- [#1175](https://github.com/tdeekens/promster/pull/1175) [`2da8d99`](https://github.com/tdeekens/promster/commit/2da8d99cc59e0223e89b985c6dddc9883e3f2f5c) Thanks [@tdeekens](https://github.com/tdeekens)! - Remove support for Node.js v18

  We didn't adjust functionality to remove support but changed the `engines` requirement.

### Patch Changes

- Updated dependencies [[`2da8d99`](https://github.com/tdeekens/promster/commit/2da8d99cc59e0223e89b985c6dddc9883e3f2f5c), [`0d8acff`](https://github.com/tdeekens/promster/commit/0d8acff62b395046023295068aa2849c5a9a55f9)]:
  - @promster/metrics@13.0.0
  - @promster/types@13.0.0

## 12.1.0

### Minor Changes

- [`6bc4617`](https://github.com/tdeekens/promster/commit/6bc4617236c86c8849f8d0ee64ace8916db907d6) Thanks [@tdeekens](https://github.com/tdeekens)! - Update dependencies and support prom-client v15.

### Patch Changes

- Updated dependencies [[`6bc4617`](https://github.com/tdeekens/promster/commit/6bc4617236c86c8849f8d0ee64ace8916db907d6)]:
  - @promster/metrics@12.1.0
  - @promster/types@12.1.0

## 12.0.0

### Major Changes

- [#1123](https://github.com/tdeekens/promster/pull/1123) [`eab1f5c`](https://github.com/tdeekens/promster/commit/eab1f5c92e46e0855a5a340675bb7b837cc270e5) Thanks [@tdeekens](https://github.com/tdeekens)! - Drop support for node.js v16

### Minor Changes

- [#1121](https://github.com/tdeekens/promster/pull/1121) [`660af55`](https://github.com/tdeekens/promster/commit/660af55e8d6d15f08fbb26544fea546513184458) Thanks [@tdeekens](https://github.com/tdeekens)! - Add support for prom-client v15

### Patch Changes

- Updated dependencies [[`660af55`](https://github.com/tdeekens/promster/commit/660af55e8d6d15f08fbb26544fea546513184458), [`eab1f5c`](https://github.com/tdeekens/promster/commit/eab1f5c92e46e0855a5a340675bb7b837cc270e5)]:
  - @promster/metrics@12.0.0
  - @promster/types@12.0.0

## 3.0.1

### Patch Changes

- [#1104](https://github.com/tdeekens/promster/pull/1104) [`1b6f280`](https://github.com/tdeekens/promster/commit/1b6f280ee639c6c204a12cca1054e9d6fa5bc504) Thanks [@tdeekens](https://github.com/tdeekens)! - Fix types of skip function.

## 3.0.0

### Major Changes

- [#1099](https://github.com/tdeekens/promster/pull/1099) [`c3fbd90`](https://github.com/tdeekens/promster/commit/c3fbd90808d2a9b244d1ca14f0ac6bfdf973dcda) Thanks [@tdeekens](https://github.com/tdeekens)! - Allow customization of individual metrics.

  Previously we only allowed customizing a all histogram and percentile based metrics once with a `buckets` and `percentiles` option. This is too restrictive in cases in which you need to customize metrics individually.

  As a result you can now pass `metricBuckets` and `metricPercentiles` as options. Both of which are a `Record<string, number[]>`. The key needs to match a an existing metric type.

  This is a more elaborate example:

  ```js
  const middleware = createMiddleware({
    app,
    options: {
      metricBuckets: {
        httpRequestContentLengthInBytes: [
          100000, 200000, 500000, 1000000, 1500000, 2000000, 3000000, 5000000,
          10000000,
        ],
        httpRequestDurationInSeconds: [
          0.05, 0.1, 0.3, 0.5, 0.8, 1, 1.5, 2, 3, 10,
        ],
      },
      metricPercentiles: {
        httpRequestDurationPerPercentileInSeconds: [0.5, 0.9, 0.95, 0.98, 0.99],
        httpResponseContentLengthInBytes: [
          100000, 200000, 500000, 1000000, 1500000, 2000000, 3000000, 5000000,
          10000000,
        ],
      },
    },
  });
  ```

  If you used `buckets` or `percentiles` before you migrate the values into the structure above.

### Minor Changes

- [#1096](https://github.com/tdeekens/promster/pull/1096) [`3ce4835`](https://github.com/tdeekens/promster/commit/3ce4835adde92e5bce10398e8dfad759c9db4753) Thanks [@tdeekens](https://github.com/tdeekens)! - Restructure TypeScript and improve types of `skip`-fn

  Previously the `skip` function received generics to pass the `request` and `response` type. These are not needed any more. The function exported from the respective package is now typed to it.

- [#1103](https://github.com/tdeekens/promster/pull/1103) [`0476e91`](https://github.com/tdeekens/promster/commit/0476e91030ae229edc021a6d1fb01a3c7a112833) Thanks [@tdeekens](https://github.com/tdeekens)! - Add support for generics to skip function.

  The `skip` function now supports generics for cases in which you have extended the request and response type in your application. The generics default to each framework's request and response type. If you need to overwrite this pass the generics as in `skip<MyRequestType, MyResponseType>(request, response)`.

### Patch Changes

- [#1093](https://github.com/tdeekens/promster/pull/1093) [`ec70682`](https://github.com/tdeekens/promster/commit/ec70682c131d3e9abf9ad5e49d82f6a5168ad8a7) Thanks [@tdeekens](https://github.com/tdeekens)! - Re-export types from each package.

  This is a convenience re-export where prior you had to use the `@promster/types` package as a standalone import you can now use the package you're using.

  ```diff
  -import { TPromsterOptions } from '@promster/types'
  +import { TPromsterOptions } from '@promster/express'
  ```

- [#1098](https://github.com/tdeekens/promster/pull/1098) [`dae8f75`](https://github.com/tdeekens/promster/commit/dae8f756e532160bb977cf3a4e18aeedbb6e61a3) Thanks [@tdeekens](https://github.com/tdeekens)! - Update dependencies

- [#1101](https://github.com/tdeekens/promster/pull/1101) [`2ebf501`](https://github.com/tdeekens/promster/commit/2ebf501dd46fb60e14231b94d553379a3852aa43) Thanks [@tdeekens](https://github.com/tdeekens)! - Update to @apollo/server v4

- [#1097](https://github.com/tdeekens/promster/pull/1097) [`04f37e7`](https://github.com/tdeekens/promster/commit/04f37e7fe6c47433ad4082579b1af129aca8b7af) Thanks [@tdeekens](https://github.com/tdeekens)! - Update dependencies

- Updated dependencies [[`ec70682`](https://github.com/tdeekens/promster/commit/ec70682c131d3e9abf9ad5e49d82f6a5168ad8a7), [`dae8f75`](https://github.com/tdeekens/promster/commit/dae8f756e532160bb977cf3a4e18aeedbb6e61a3), [`c3fbd90`](https://github.com/tdeekens/promster/commit/c3fbd90808d2a9b244d1ca14f0ac6bfdf973dcda), [`3ce4835`](https://github.com/tdeekens/promster/commit/3ce4835adde92e5bce10398e8dfad759c9db4753), [`04f37e7`](https://github.com/tdeekens/promster/commit/04f37e7fe6c47433ad4082579b1af129aca8b7af)]:
  - @promster/metrics@11.0.0
  - @promster/types@5.0.0

## 2.0.0

### Major Changes

- [#1088](https://github.com/tdeekens/promster/pull/1088) [`7cfd21c`](https://github.com/tdeekens/promster/commit/7cfd21c2cd4d402cabd454cdc67f76ecce104fb0) Thanks [@tdeekens](https://github.com/tdeekens)! - Breaking droping support for Node.js v14

- [#1087](https://github.com/tdeekens/promster/pull/1087) [`2e848c1`](https://github.com/tdeekens/promster/commit/2e848c13be1053ad22b0aa2210bcbb677b66ed62) Thanks [@roumigus](https://github.com/roumigus)! - The `up` metric of each server integrating `@promster` has been renamed to `nodejs_up`. This is to avoid a collision with the existing `up` metric [Prometheus uses](https://prometheus.io/docs/concepts/jobs_instances/#automatically-generated-labels-and-time-series).

  You can still rename this metric to anything you prefer when condfigurating `@promster/express` for instance like this:

  ```js
  const prometheusMetricsMiddleware = createPrometheusMetricsMiddleware({
    options: {
      metricNames: {
        up: ["service_name_up"],
      },
    },
  });
  ```

### Patch Changes

- [#1090](https://github.com/tdeekens/promster/pull/1090) [`31b82fd`](https://github.com/tdeekens/promster/commit/31b82fd59139f0faf273c8e70e63f4bd5e0b4af7) Thanks [@tdeekens](https://github.com/tdeekens)! - Replace yarn with pnpm.

- Updated dependencies [[`31b82fd`](https://github.com/tdeekens/promster/commit/31b82fd59139f0faf273c8e70e63f4bd5e0b4af7), [`7cfd21c`](https://github.com/tdeekens/promster/commit/7cfd21c2cd4d402cabd454cdc67f76ecce104fb0), [`2e848c1`](https://github.com/tdeekens/promster/commit/2e848c13be1053ad22b0aa2210bcbb677b66ed62)]:
  - @promster/metrics@10.0.0

## 1.0.8

### Patch Changes

- [#1006](https://github.com/tdeekens/promster/pull/1006) [`8df4fe6`](https://github.com/tdeekens/promster/commit/8df4fe6a4cd6ff86260ce546411200d7e4d98802) Thanks [@tdeekens](https://github.com/tdeekens)! - chore: update deps

- Updated dependencies [[`58ffa97`](https://github.com/tdeekens/promster/commit/58ffa977892fa97f47fdbf208f76bd0ef2b8b2ee), [`8df4fe6`](https://github.com/tdeekens/promster/commit/8df4fe6a4cd6ff86260ce546411200d7e4d98802)]:
  - @promster/metrics@9.1.6

## 1.0.7

### Patch Changes

- [`5d4842e`](https://github.com/tdeekens/promster/commit/5d4842e5d60136effcff1905b06b6bae06063c3b) Thanks [@tdeekens](https://github.com/tdeekens)! - Update all dependencies

- Updated dependencies [[`5d4842e`](https://github.com/tdeekens/promster/commit/5d4842e5d60136effcff1905b06b6bae06063c3b)]:
  - @promster/metrics@9.1.5

## 1.0.6

### Patch Changes

- [#868](https://github.com/tdeekens/promster/pull/868) [`7a084f2`](https://github.com/tdeekens/promster/commit/7a084f214ef7f7d81e8c06f04b5a7abdbf78c456) Thanks [@earnubs](https://github.com/earnubs)! - Fix GraphQL execution error counting

  This fixes a bug which caused GraphQL errors thrown were not counted when
  encountered in GraphQL execution phase.

  During the execution phase GraphQL request are fulfilled and can result in data or an error.

  Additionally, the any error not handled would threw a plugin error due to a missing label `field_name` in the intial label set.

## 1.0.5

### Patch Changes

- [#865](https://github.com/tdeekens/promster/pull/865) [`abc0df1`](https://github.com/tdeekens/promster/commit/abc0df1a08e46c36659165938b62b3764501cf6d) Thanks [@tdeekens](https://github.com/tdeekens)! - Fix timing to not truncate fractional numbers.

- Updated dependencies [[`abc0df1`](https://github.com/tdeekens/promster/commit/abc0df1a08e46c36659165938b62b3764501cf6d)]:
  - @promster/metrics@9.1.4

## 1.0.4

### Patch Changes

- [#848](https://github.com/tdeekens/promster/pull/848) [`0e033fa`](https://github.com/tdeekens/promster/commit/0e033fa7ac414dc3692ceedf54eca6cfc2370ff0) Thanks [@tdeekens](https://github.com/tdeekens)! - Update dependencies

- Updated dependencies [[`defcae7`](https://github.com/tdeekens/promster/commit/defcae775e7280a5746db4c2e75226353d7bdf40), [`0e033fa`](https://github.com/tdeekens/promster/commit/0e033fa7ac414dc3692ceedf54eca6cfc2370ff0)]:
  - @promster/metrics@9.1.3

## 1.0.3

### Patch Changes

- [#804](https://github.com/tdeekens/promster/pull/804) [`9a1827d`](https://github.com/tdeekens/promster/commit/9a1827da3d4983ce141e77a0e7ea05f11f2bcee6) Thanks [@tdeekens](https://github.com/tdeekens)! - chore: update deps

- Updated dependencies [[`9a1827d`](https://github.com/tdeekens/promster/commit/9a1827da3d4983ce141e77a0e7ea05f11f2bcee6)]:
  - @promster/metrics@9.1.2

## 1.0.2

### Patch Changes

- [#794](https://github.com/tdeekens/promster/pull/794) [`06cf42b`](https://github.com/tdeekens/promster/commit/06cf42b46bd216f6c3c182452d6badfe1029c7d3) Thanks [@tdeekens](https://github.com/tdeekens)! - Fix package names from `yarn@3` migration

- Updated dependencies [[`06cf42b`](https://github.com/tdeekens/promster/commit/06cf42b46bd216f6c3c182452d6badfe1029c7d3)]:
  - @promster/metrics@9.1.1

## 1.0.1

### Patch Changes

- [#791](https://github.com/tdeekens/promster/pull/791) [`7f44d2e`](https://github.com/tdeekens/promster/commit/7f44d2e16b506cb53ff0009f4f74a8ccef192ce0) Thanks [@tdeekens](https://github.com/tdeekens)! - Refactor to use `process.hrtime.bigint()` over `process.hrtime()`.

  The [Node.js documentation](https://nodejs.org/api/process.html#processhrtimetime) lists `process.hrtime([time])` as a [legacy feature](https://nodejs.org/api/documentation.html#stability-index). It is no longer recommended for use, and should be avoided. As such it is recommended to use `process.hrtime.bigint()` which works slightly different.

  This change is backwards compatible. A new `timing` module was added to `@promster/metrics` which encapsulates timings so you never have to worry about the details.

  ```diff
  import { getRequestRecorder } = require('@promster/express');
  +import { timing } = require('@promster/express');

  +const requestTiming = timing.start();
  -const requestTiming = process.hrtime();

  recordRequest(requestTiming);
  ```

  We recommend to change all explicit calls to `process.hrtime()` with calls to `timing.start()` over time. The `recordRequest` function will continue to accept a `[number, number]` as the return of `process.hrtime()` so you can change code as you work with it.

- Updated dependencies [[`7f44d2e`](https://github.com/tdeekens/promster/commit/7f44d2e16b506cb53ff0009f4f74a8ccef192ce0)]:
  - @promster/metrics@9.1.0

## 1.0.0

### Major Changes

- [#786](https://github.com/tdeekens/promster/pull/786) [`b32db63`](https://github.com/tdeekens/promster/commit/b32db6353b09af41c4a053f976771938cadde233) Thanks [@tdeekens](https://github.com/tdeekens)! - Iniitial release of `@promster/apollo`.

### Patch Changes

- [#777](https://github.com/tdeekens/promster/pull/777) [`9d6a2ee`](https://github.com/tdeekens/promster/commit/9d6a2ee81ea3e40fac3e788d9942f66c868670a5) Thanks [@tdeekens](https://github.com/tdeekens)! - refactor: to use yarn@3

* [#776](https://github.com/tdeekens/promster/pull/776) [`7158530`](https://github.com/tdeekens/promster/commit/71585308af86964ede48412b3e0d75545aee7aca) Thanks [@tdeekens](https://github.com/tdeekens)! - chore: add changeset for apollo

* Updated dependencies [[`d49c30f`](https://github.com/tdeekens/promster/commit/d49c30f0004e0f4883ac356598ddf82b87b7c9d6), [`402c8c0`](https://github.com/tdeekens/promster/commit/402c8c01a3dfa605d47e0f974ac554d65c237d50), [`e5658c7`](https://github.com/tdeekens/promster/commit/e5658c7189d09071a21c299b78423e0782392c07), [`e5658c7`](https://github.com/tdeekens/promster/commit/e5658c7189d09071a21c299b78423e0782392c07), [`1b84464`](https://github.com/tdeekens/promster/commit/1b8446455324e4ceefb4b032eddb43e9b8bb63d2), [`548c56e`](https://github.com/tdeekens/promster/commit/548c56e1ec7ccaa5b1aca71d33db65ad91e64f3c), [`5e67884`](https://github.com/tdeekens/promster/commit/5e6788481fee15479c6505d3475ab716f7378f33), [`dfc14a3`](https://github.com/tdeekens/promster/commit/dfc14a3d8ec309723c6b904949e506c63c04c3c0), [`9d6a2ee`](https://github.com/tdeekens/promster/commit/9d6a2ee81ea3e40fac3e788d9942f66c868670a5)]:
  - @promster/metrics@9.0.0
